{%- assign whitelist = site.jekyll_cmdbrew.file_preview_whitelist -%}
{%- assign i18n = site.data.translations -%}
{%- capture ext -%}
  {{- page.file | split: '.' | last -}}
{%- endcapture -%}
<!-- Get next and previous URLs (START) -->
{% capture the_collection %}{{ page.collection }}{% endcapture %}
{% if page.collection %}
  {% assign document = site[the_collection] %}
{% endif %}

{% for links in document %}
  {% if links.title == page.title %}
    {% unless forloop.first %}
      {% assign prevurl = prev.url %}
      {% assign prevtitle = prev.title %}
    {% endunless %}
    {% unless forloop.last %}
      {% assign next = document[forloop.index] %}
      {% assign nexttitle = next.title %}
      {% assign nexturl = next.url %}
    {% endunless %}
  {% endif %}
  {% assign prev = links %}
{% endfor %}
<!-- Get next and previous URLs (END) -->

<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">
  {%- include head.html -%}
  <body class="layout-file">
    {% if site.jekyll_cmdbrew.snippets.header %}
      {% include {{ site.jekyll_cmdbrew.snippets.header | prepend: 'snippets/' }} %}
    {% endif %}

    {%- include notice/alert.html -%}
    <div id="wrapper" class="order-1">
      <main id="main">
        {%- include headers/file.html -%}
        <div id="page-nav">
          {%- if prevurl -%}
            <a class="page-nav previous btn btn-light" href="{{ prevurl | relative_url }}">
              <i class="fas fa-long-arrow-alt-left"></i>
            </a>
          {%- endif -%}
          {%- if nexturl -%}
            <a class="page-nav next btn btn-light" href="{{ nexturl | relative_url }}">
              <i class="fas fa-long-arrow-alt-right"></i>
            </a>
          {%- endif -%}
        </div>

        <div id="content" class="overflow-y">
          {%- if whitelist contains ext -%}
            <div class="file-wrap bg-file">
              <img src="{{ page.file | relative_url }}?nf_resize=fit&w=2244" alt="{{ page.alt | default: page.title }}"/>
            </div>
          {%- elsif ext == 'pdf' -%}
            <div class="object-wrap bg-file">
              <iframe frameborder="0" src="{{ page.file | relative_url }}?preview={{ page.title | slugify }}#toolbar=0&navpanes=0&scrollbar=0" class="h-100 w-100"></iframe>
            </div>
          {%- else -%}
            <div class="text-center text-secondary my-5">
              <div>
                <i class="far fa-file-archive fa-4x mb-3"></i>
              </div>
              <p>{{ i18n.files.file.no_preview | default: "No preview available" }}</p>
            </div>
          {%- endif -%}

          <div class="visible-collapse mb-4">
            <div class="divider"></div>
            <div class="container my-4 px-offset">
              {%- include files/info.html -%}
            </div>
          </div>
        </div>
      </main>
      {%- include asides/file.html -%}
    </div>

    {% if site.jekyll_cmdbrew.snippets.footer %}
      {% include {{ site.jekyll_cmdbrew.snippets.footer | prepend: 'snippets/' }} %}
    {% endif %}
    {%- include scripts/cookies_alert.html -%}
  </body>
</html>